# Customizing content collections

## Content collections

A top-level directory within `src/content` is considered a "content collection" by Mathlified. Files within each collection are grouped together and handled in a similar fashion.

The default behavior of Mathlified is to handle all `md` and `ts` files as "content" written in Djot markup, as we have investigated in the [Notes](/notes/calculus) and [Questions](/questions/elementary-algebra-2e) sections. The rest of this section will show how we can create a custom collection.

## Broad overview of how Mathlified works

When Mathlified detects a new content collection in the `src/content` folder, it will attempt to create the necessary `+page.server.ts` and `+page.svelte` files under `routes/[collection]`.

1. `+page.server.ts` preprocesses `md` and `ts` files, and passes the output (by default, the "content" made up of Djot markup, along with any relevant front matter like the title) to the `+page.svelte` component.
2. `+page.svelte` receives this data and renders it using a component. By default, this uses the `Content.svelte` and `Djot.svelte` components generated by Mathlified to display the content.

To customize this behavior, we will need to create custom preprocesses and components. In this "quiz" section, we will do this to create interactive and dynamic content.

## Steps to customize a content collection

### Step 1: Create preprocessors

For our "quiz" collection, we create a `quiz.ts` file in `lib/server`. This should export a `preprocess` object with the following type

```ts
interface Preprocess {
  md?: (x: string) => Data;
  module?: (x: Module) => Data;
}
```

`Data` is the form of the data that will be passed to the `+page.svelte` component (so it must be serializable). The `md` function will preprocess `.md` files in our collection, while the `module` function will preprocess `.ts` files (the form of which is the `Module` type).

For our 'quiz' collection, we will only be customizing behavior of `ts` files. Mathlified will default to the content-centric behavior of the previous two sections if any preprocessor is not specified.

For our example, our custom `lib/server/quiz.ts` only preprocess `.ts` files and generates `title` and `state`.

### Step 2: Create a custom Svelte component

We now need to tell SvelteKit how to use the `quiz/xxx.ts` module and the data passed from the server to render out our
final page. This is done by creating a svelte component in `lib/components` with the same name (but with first letter capitalized)
as our content collection.

This svelte component will take 2 props

1. `data` is the output of the preprocessor, with an additional `isMd` property
2. `module` represents the `quiz/xxx.ts` module, which will be `null` if `isMD` is true

The default behavior if either a `md` or `module` preprocessor is not specified is tot output a `data` object with
`title` and `content`.

For our example, the custom component is `Quiz.svelte`. Take a look at this file.

If `isMd` is true, we use the `Content.svelte` component, passing in `data.content` (similar to the default behavior).

For `ts` files, we use `data.title` to set the heading. We then use our `module` to get the `generateQn` function to get the Djot markup for our question and answer. We also use the `generateState` function to generate new questions when a user clicks the "Generate New" button.

Note that the module is loaded asynchronously which necessitates the use of the `await` keyword throughout the code.

### Step 3: Create content

With the preprocessor and custom component in place, Mathlified can take over and set up the necessary plumbing. We are now ready to go forth and create content under this new, custom structure.

Take a look at `1-arithmetic.ts` and `2-algebra.ts` to see how the next two pages are built.
